
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>Upgrade from old versions Â· GitBook</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.1.1">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="howto_ldap_and_sso.html" />
    
    
    <link rel="prev" href="howto_jdbc.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../">
            
                <a href="../">
            
                    
                    Getting Started
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../gettingstarted/concepts.html">
            
                <a href="../gettingstarted/concepts.html">
            
                    
                    Technical Concepts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../release_notes.html">
            
                <a href="../release_notes.html">
            
                    
                    KAP Release Notes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../gettingstarted/events.html">
            
                <a href="../gettingstarted/events.html">
            
                    
                    Events and Conferences
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../gettingstarted/best_practices.html">
            
                <a href="../gettingstarted/best_practices.html">
            
                    
                    Community Best Practices
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../gettingstarted/terminology.html">
            
                <a href="../gettingstarted/terminology.html">
            
                    
                    Terminology
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../gettingstarted/faq.html">
            
                <a href="../gettingstarted/faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../install/">
            
                <a href="../install/">
            
                    
                    Installation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../install/hadoop_evn.html">
            
                <a href="../install/hadoop_evn.html">
            
                    
                    Hadoop Enviroument
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../install/kylin_cluster.html">
            
                <a href="../install/kylin_cluster.html">
            
                    
                    Deploy in cluster mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../install/advance_settings.html">
            
                <a href="../install/advance_settings.html">
            
                    
                    Advance Settings
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../tutorial/kylin_sample.html">
            
                <a href="../tutorial/kylin_sample.html">
            
                    
                    Tutorial
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../tutorial/kylin_sample.html">
            
                <a href="../tutorial/kylin_sample.html">
            
                    
                    Quick Start with Sample Cube
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../tutorial/create_cube.html">
            
                <a href="../tutorial/create_cube.html">
            
                    
                    KAP Cube Creation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../tutorial/cube_build_job.html">
            
                <a href="../tutorial/cube_build_job.html">
            
                    
                    KAP Cube Build and Job Monitoring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../tutorial/acl.html">
            
                <a href="../tutorial/acl.html">
            
                    
                    KAP Cube Permission
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../tutorial/web.html">
            
                <a href="../tutorial/web.html">
            
                    
                    KAP Web Interface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../tutorial/tableau.html">
            
                <a href="../tutorial/tableau.html">
            
                    
                    Tableau 8
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../tutorial/tableau_91.html">
            
                <a href="../tutorial/tableau_91.html">
            
                    
                    Tableau 9
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../tutorial/powerbi.html">
            
                <a href="../tutorial/powerbi.html">
            
                    
                    MS Excel and Power BI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../tutorial/odbc.html">
            
                <a href="../tutorial/odbc.html">
            
                    
                    KAP ODBC Driver
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="howto_build_cube_with_restapi.html">
            
                <a href="howto_build_cube_with_restapi.html">
            
                    
                    How to
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="howto_build_cube_with_restapi.html">
            
                <a href="howto_build_cube_with_restapi.html">
            
                    
                    Build Cube with RESTful API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="howto_use_restapi_in_js.html">
            
                <a href="howto_use_restapi_in_js.html">
            
                    
                    Use RESTful API in Javascript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="howto_use_restapi.html">
            
                <a href="howto_use_restapi.html">
            
                    
                    Use RESTful API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="howto_optimize_cubes.html">
            
                <a href="howto_optimize_cubes.html">
            
                    
                    Optimize Cube
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="howto_backup_metadata.html">
            
                <a href="howto_backup_metadata.html">
            
                    
                    Backup Metadata
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="howto_cleanup_storage.html">
            
                <a href="howto_cleanup_storage.html">
            
                    
                    Cleanup Storage(HDFS&HBase Tables)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="howto_jdbc.html">
            
                <a href="howto_jdbc.html">
            
                    
                    Use KAP Remote JDBC Driver
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.8" data-path="howto_upgrade.html">
            
                <a href="howto_upgrade.html">
            
                    
                    Upgrade from old versions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="howto_ldap_and_sso.html">
            
                <a href="howto_ldap_and_sso.html">
            
                    
                    Enable Security with LDAP and SSO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="howto_update_coprocessor.html">
            
                <a href="howto_update_coprocessor.html">
            
                    
                    How to Update HBase Coprocessor
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Upgrade from old versions</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="upgrade-from-151-to-v152">Upgrade from 1.5.1 to v1.5.2</h2>
<p>Kylin v1.5.2 metadata is compitible with v1.5.1, your cubes don&apos;t need upgrade, while some actions need to be performed:</p>
<h4 id="1-update-hbase-coprocessor">1. Update HBase coprocessor</h4>
<p>The HBase tables for existing cubes need be updated to the latest coprocessor; Follow <a href="howto_update_coprocessor.html">this guide</a> to update;</p>
<h4 id="2-update-kylinproperties">2. Update kylin.properties</h4>
<p>In v1.5.2 several properties are deprecated, and several new one are added:</p>
<p>Deprecated:</p>
<ul>
<li>kylin.hbase.region.cut.small=5</li>
<li>kylin.hbase.region.cut.medium=10</li>
<li>kylin.hbase.region.cut.large=50</li>
</ul>
<p>New:</p>
<ul>
<li>kylin.hbase.region.cut=5</li>
<li>kylin.hbase.hfile.size.gb=2</li>
</ul>
<p>These new parameters determines how to split HBase region; To use different size you can overwite these params in Cube level. </p>
<p>When copy from old kylin.properties file, suggest to remove the deprecated ones and add the new ones.</p>
<h4 id="3-add-confkylinjobconfinmemxml">3. Add conf/kylin_job_conf_inmem.xml</h4>
<p>A new job conf file named &quot;kylin_job_conf_inmem.xml&quot; is added in &quot;conf&quot; folder; As Kylin 1.5 introduced the &quot;fast cubing&quot; algorithm, which aims to leverage more memory to do the in-mem aggregation; Kylin will use this new conf file for submitting the in-mem cube build job, which requesting different memory with a normal job; Please update it properly according to your cluster capacity.</p>
<p>Besides, if you have used separate config files for different capacity cubes, for example &quot;kylin_job_conf_small.xml&quot;, &quot;kylin_job_conf_medium.xml&quot; and &quot;kylin_job_conf_large.xml&quot;, please note that they are deprecated now; Only &quot;kylin_job_conf.xml&quot; and &quot;kylin_job_conf_inmem.xml&quot; will be used for submitting cube job; If you have cube level job configurations (like using different Yarn job queue), you can customize at cube level, check <a href="https://issues.apache.org/jira/browse/KYLIN-1706" target="_blank">KYLIN-1706</a></p>
<h2 id="upgrade-from-prior-15-to-v151">Upgrade from prior 1.5 to v1.5.1</h2>
<p>Kylin 1.5.1 is not backward compatible in terms of metadata. (The built cubes are still functional after metadata upgrade) So if you want to deploy v1.5.x code on your prior 1.5 metadata store (in the following text we&apos;ll use v1.3.0 as example), you need to upgrade the metadata as following steps:</p>
<h4 id="1-backup-metadata-on-v130">1. Backup metadata on v1.3.0</h4>
<p>To avoid data loss during the upgrade, a backup at the very beginning is always suggested. In case of upgrade failure, you can roll back to original state with the backup.</p>
<pre><code>export KYLIN_HOME=&quot;&lt;path_of_1_3_0_installation&gt;&quot; 
$KYLIN_HOME/bin/metastore.sh backup
</code></pre><p>It will print the backup folder, write it down and make sure it will not be deleted before the upgrade finished. We&apos;ll later reference this folder as BACKUP_FOLDER.</p>
<h4 id="2-stop-kylin-v130-instance">2. Stop Kylin v1.3.0 instance</h4>
<p>Before deploying Kylin v1.5.1 instance, you need to stop the old instance. Note that end users cannot access kylin service from this point.</p>
<pre><code>$KYLIN_HOME/bin/kylin.sh stop
</code></pre><h4 id="3-install-kylin-v151-and-copy-back-conf">3. Install Kylin v1.5.1 and copy back &quot;conf&quot;</h4>
<p>Download the new Kylin v1.5.1 binary package from Kylin&apos;s download page; Extract it to a different folder other than current KYLIN_HOME; Before copy back the &quot;conf&quot; folder, do a compare and merge between the old and new kylin.properties to ensure newly introduced property will be kept.</p>
<h4 id="4-automaticly-upgrade-metadata">4. Automaticly upgrade metadata</h4>
<p>Kylin v1.5.1 package provides a tool for metadata automaticly upgrade. In this upgrade, all cubes&apos; metadata will be updated to v1.5.1 compatible format. The treatment of empty cubes and non-empty cubes are different though. For empty cubes, we&apos;ll upgrade the cube&apos;s storage engine and cubing engine to the latest, so that new features will be enabled for the new coming cubing jobs. But those non-empty cubes carries legacy cube segments, so we&apos;ll remain its old storage engine and cubing engine. In other word, the non-empty cubes will not enjoy the performance and storage wise gains released in 1.5.x versions. Check the last section to see how to deal with non-empty cubes.
To avoid corrupting the metadata store, metadata upgrade is performed against a copy of the local metadata backup, i.e. a copy of BACKUP_FOLDER.</p>
<pre><code>export KYLIN_HOME=&quot;&lt;path_of_1_5_0_installation&gt;&quot; 
$KYLIN_HOME/bin/kylin.sh  org.apache.kylin.cube.upgrade.entry.CubeMetadataUpgradeEntry_v_1_5_1 &lt;path_of_BACKUP_FOLDER&gt;
</code></pre><p>The above commands will first copy the BACKUP_FOLDER to ${BACKUP_FOLDER}_workspace, and perform the upgrade against the workspace folder at local disk. Check the output, if no error happened, then you have a 1.5.1 compatible metadata saved in the workspace folder now. Otherwise the upgrade process is not successful, please don&apos;t take further actions. 
The next thing to do is to override the metatdata store with the new metadata in workspace:</p>
<pre><code>$KYLIN_HOME/bin/metastore.sh reset
$KYLIN_HOME/bin/metastore.sh restore &lt;path_of_workspace&gt;
</code></pre><p>The last thing to do is to upgrade all cubes&apos; coprocessor:</p>
<pre><code>$KYLIN_HOME/bin/kylin.sh org.apache.kylin.storage.hbase.util.DeployCoprocessorCLI $KYLIN_HOME/lib/kylin-coprocessor*.jar all
</code></pre><h4 id="6-start-kylin-v151-instance">6. Start Kylin v1.5.1 instance</h4>
<pre><code>$KYLIN_HOME/bin/kylin.sh start
</code></pre><p>Check the log and open web UI to see if the upgrade succeeded.</p>
<h2 id="rollback-if-the-upgrade-is-failed">Rollback if the upgrade is failed</h2>
<p>If the new version couldn&apos;t startup normally, you need to roll back to orignal v1.3.0 version. The steps are as followed:</p>
<h4 id="1-stop-kylin-v151-instance">1. Stop Kylin v1.5.1 instance</h4>
<pre><code>$KYLIN_HOME/bin/kylin.sh stop
</code></pre><h4 id="2-restore-130-metadata-from-backup-folder">2. Restore 1.3.0 metadata from backup folder</h4>
<pre><code>export KYLIN_HOME=&quot;&lt;path_of_1_3_0_installation&gt;&quot;
$KYLIN_HOME/bin/metastore.sh reset
$KYLIN_HOME/bin/metastore.sh restore &lt;path_of_BACKUP_FOLDER&gt;
</code></pre><h4 id="3-deploy-coprocessor-of-v130">3. Deploy coprocessor of v1.3.0</h4>
<p>Since coprocessor of used HTable are upgraded as v1.5.1, you need to manually downgrade them with this command.</p>
<pre><code>$KYLIN_HOME/bin/kylin.sh org.apache.kylin.job.tools.DeployCoprocessorCLI $KYLIN_HOME/lib/kylin-coprocessor*.jar all
</code></pre><h4 id="4-start-kylin-v130-instance">4. Start Kylin v1.3.0 instance</h4>
<pre><code>$KYLIN_HOME/bin/kylin.sh start
</code></pre><h2 id="for-non-empty-cubes">For non-empty cubes</h2>
<p>Since old cubes built with v1.3.0 cannot leverage new features of v1.5.1. But if you must have them on your cubes, you can choose one of these solutions:</p>
<h4 id="1-rebuild-cubes">1. Rebuild cubes</h4>
<p>This is the simplest way: If the cost of rebuilding is acceptable, if you purge the cube before Metadata Upgrade. After upgrade done, you need to manually rebuild those segments by yourself.</p>
<h4 id="2-use-hybrid-model">2. Use hybrid model</h4>
<p>If you can&apos;t rebuild any segments, but want to leverage new features for new segments. You can use hybrid model, which contains not only your old segments, but also an new empty cube which has same model with the old one. For the empty cube, you can do incremental building with new v1.5.x features. For the old cube, you can refresh existing segments only.</p>
<p>Here is the command to create hybrid model:</p>
<pre><code>export KYLIN_HOME=&quot;&lt;path_of_1_5_0_installation&gt;&quot;
$KYLIN_HOME/bin/kylin.sh org.apache.kylin.storage.hbase.util.ExtendCubeToHybridCLI &lt;project_name&gt; &lt;cube_name&gt;
</code></pre>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="howto_jdbc.html" class="navigation navigation-prev " aria-label="Previous page: Use KAP Remote JDBC Driver">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="howto_ldap_and_sso.html" class="navigation navigation-next " aria-label="Next page: Enable Security with LDAP and SSO">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"layout":"docs15","title":"Upgrade from old versions","categories":"howto","permalink":"/docs15/howto/howto_upgrade.html","since":"v1.5.1","level":"1.5.8","depth":2,"next":{"title":"Enable Security with LDAP and SSO","level":"1.5.9","depth":2,"path":"manual/howto/howto_ldap_and_sso.md","ref":"manual/howto/howto_ldap_and_sso.md","articles":[]},"previous":{"title":"Use KAP Remote JDBC Driver","level":"1.5.7","depth":2,"path":"manual/howto/howto_jdbc.md","ref":"manual/howto/howto_jdbc.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"manual/howto/howto_upgrade.md","mtime":"2016-06-23T04:07:33.000Z","type":"markdown"},"gitbook":{"version":"3.1.1","time":"2016-06-23T09:20:13.690Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

